"use strict";define(["angular","app","config.lazyload","config.router"],function(t,e){e.service("BaseService",["$http","$q","$log","$timeout","jwtHelper","blockUI",function(e,r,n,a,i,s){var l={promise:null,isInit:null,isInitialized:!1,allDatas:null,treeData:null,dataUrl:"",batchUrl:"",dataIdUrl:"",authUser:null,ids:null,getDataUrl:function(){return this.dataUrl},getIdDataUrl:function(){return this.dataIdUrl},getIds:function(){return this.ids},setIds:function(t){this.ids=t},setAllDatas:function(t){this.allDatas=t},getAllDatas:function(){return this.allDatas},setTreeData:function(t){this.treeData=t},getTreeData:function(){return this.treeData},getOptions:function(){var t=this,e=[],r=t.getAllDatas();for(var n in r){var a=r[n];e.push({text:a.name,value:a.id})}return e},urls:function(t){this.dataUrl=t.dataUrl,this.batchUrl=t.batchUrl,this.dataIdUrl=t.dataIdUrl},init:function(t){s.start("Loading...");var e=this;e.urls(t);var r=e._http_get(e.dataUrl).then(function(t){e.setAllDatas(t),e.isInitialized=!0,s.stop()},function(t){deferred.reject(t),s.stop()});e.promise=r,e.isInit=r;var n=localStorage.getItem("id_token");null!=n&&""!=n&&(e.authUser=i.decodeToken(n))},listData:function(t){null==t&&(t=!1),s.start("Loading...");var e=this;if(e.isInitialized&&!t){var n=r.defer();return a(function(){n.resolve(e.getAllDatas()),s.stop()}),n.promise}var n=r.defer();return e._http_get(e.dataUrl).then(function(t){e.setAllDatas(t),e.isInitialized=!0,n.resolve(t),s.stop()},function(t){n.reject(t),s.stop()}),n.promise},_http_get:function(t){var a=r.defer();return e.get(t).success(function(t){try{if(t instanceof Array)for(var e in t)t[e].selected=!1;else null!=t&&(t.selected=!1);a.resolve(t)}catch(r){console.error(r),console.error(r.getStack())}}).error(function(t,e){a.reject(t),n.error(t,e)}),a.promise},fetchDataFromUrl:function(t){var e=this;s.start("Loading...");var n=r.defer();return e._http_get(t).then(function(t){n.resolve(t),s.stop()},function(t){n.reject(t),s.stop()}),n.promise},listDataByAid:function(t){var e=this,n=(r.defer(),e.dataUrl.replace(":aid",t));return e._http_get(n)},createData:function(t){s.start("Creating...");var e=this,n=r.defer();return e._http_post(e.dataUrl,t).then(function(t){if(e.isInitialized){var r=e.getAllDatas();r[r.length]=t,e.setAllDatas(r)}n.resolve(t),s.stop()},function(t){n.reject(t),s.stop()}),n.promise},_http_post:function(t,a){var i=r.defer();return e.post(t,a).success(function(t){i.resolve(t)}).error(function(t,e){i.reject(t),n.error(t,e)}),i.promise},updateData:function(t){s.start("Updating...");var e=this,n=r.defer();return e._http_put(e.dataUrl,t).then(function(t){if(e.isInitialized){var r=e.getAllDatas();for(var a in r)if(r[a].id==t.id){r[a]=t;break}e.setAllDatas(r)}n.resolve(t),s.stop()},function(t){n.reject(t),s.stop()}),n.promise},_http_put:function(t,a){var i=r.defer();return e.put(t,a).success(function(t){i.resolve(t)}).error(function(t,e){i.reject(t),n.error(t,e)}),i.promise},deleteData:function(t){s.start("Deleting...");var e=this,n=e.dataIdUrl.replace(":id",t.id),a=r.defer();return e._http_delete(n).then(function(t){if(e.isInitialized){var r=e.getAllDatas(),n=[];for(var i in r)r[i].id!=t.id&&(n[n.length]=r[i]);e.setAllDatas(n)}a.resolve(t),s.stop()},function(t){a.reject(t),s.stop()}),a.promise},_http_delete:function(t){var a=r.defer();return e["delete"](t).success(function(t){a.resolve(t)}).error(function(t,e){a.reject(t),n.error(t,e)}),a.promise},getDataById:function(t){var e=this,n=r.defer(),i=e.getIds();if(null!=i)if(null!=i[t])a(function(){n.resolve(i[t])});else{var l=e.dataIdUrl.replace(":id",t);s.start("Loading..."),e._http_get(l).then(function(r){var a=e.getIds();null==a&&(a=[]),a[t]=r,e.setIds(a),n.resolve(r),s.stop()},function(t){n.reject(t),s.stop()})}else{i=[];var o=this.getAllDatas();if(null!=o){for(var u in o)i[o[u].id]=o[u];e.setIds(i),a(function(){n.resolve(i[t])})}else{var l=e.dataIdUrl.replace(":id",t);s.start("Loading..."),e._http_get(l).then(function(r){var a=e.getIds();null==a&&(a=[]),a[t]=r,e.setIds(a),n.resolve(r),s.stop()},function(t){n.reject(t),s.stop()})}}return n.promise},setDataAt:function(t,e){var r=this.getAllDatas();r[t]=e,this.setAllDatas(r)},getDataLength:function(){var t=this.getAllDatas();return t.length},getDataAt:function(t){var e=this.getAllDatas();return e[t]},getTree:function(e,r,n){var a=t.copy(e);if(!a||0==a.length||!r||!n)return[];for(var i,s,l=[],o=[],u=a[0],c=u[r],d={},f={},h=a.length,v=0;h>v;)if(u=a[v++],c=u[r],f[c]&&(u.children=f[c],delete f[c]),d[c]=u,i=u[n])if(s=d[i])s.children?s.children.push(u):s.children=[u];else{var p=f[i];p?p.push(u):f[i]=[u]}else o.push(c);for(var v=0;v<o.length;v++)l.push(d[o[v]]);return l},reverseTree:function(t){var e=this,r=[];for(var n in t)if(r[r.length]=t[n],t[n].children&&0!=t[n].children.length){var a=e.reverseTree(t[n].children);for(var i in a)r[r.length]=a[i];t[n].children=[]}else;return r},getTree2:function(e,r,n){var a=t.copy(e);if(!a||0==a.length||!r||!n)return[];for(var i,s,l=[],o=[],u=a[0],c=u[r],d={},f={},h=a.length,v=0;h>v;)if(u=a[v++],u.nodes=[],c=u[r],f[c]&&(u.children=f[c],delete f[c]),d[c]=u,i=u[n])if(s=d[i])s.nodes?s.nodes.push(u):s.nodes=[u];else{var p=f[i];p?p.push(u):f[i]=[u]}else o.push(c);for(var v=0;v<o.length;v++)l.push(d[o[v]]);return l},reverseTree2:function(t){var e=this,r=[];for(var n in t)if(r[r.length]=t[n],t[n].nodes&&0!=t[n].nodes.length){var a=e.reverseTree(t[n].nodes);for(var i in a)r[r.length]=a[i];t[n].children=[]}else;return r}};return l}])});
